# 3 Mon

## 가상화폐 투자공식

### PART4. 가상화폐 실전 투자 전략 - 3

#### 어떤 전략을 실전에 사용해야 할까?

* 보통 복리수익이 가장 높은 전략을 고르기 마련이다. 이 선택이 잘못된 것은 아니지만 강조할 점은 실전에서 MDD가 낮은 전략이 견디기가 쉽다는 것이다.
* 이성적으로 승률과 손익비가 유리한 조건에서 복리 수익이 높은 전략을 고르기 마련인데 우리의 두뇌, 특히 편향에 휩싸인 원숭이 두뇌는 긍정적인 피드백이 필요하다. 부정적인 피드백이 지속적으로 오면 매매가 어려워진다.
  * 안 돼! 또 깨지고 싶지 않아!
  * 지금 팔면 이따 파는 것보다 이득인데!
* 따라서 실전에서는 승률이 높은 전략, MDD가 낮은 전략이 유지하기가 쉽다. 물론 승률 뿐만 아니라 손익비도 수반되어야 한다.
* 승률 80% 전략이 있어도 따라오지 않으면 도루묵이다.

> 수익이 가장 뛰어난 전략을 개발하는 것이 주목적이 아니다. 실전에서 심리적으로 버티기 쉬운 "꽤 괜찮은 전략'이 오히려 수익 창출의 지름길이다.

### 투자 전략 11. 다자 가상화폐 + 평균 노이즈 비율

* 지금까지 다룬 `분산투자 + 상승장 + 변동성 돌파 + 변동성 조절` 만 해도 수익이 안정적인데, 여기에 잠깐 언급한 `타임 프레임 분산 전략` 까지 추가하면 훨씬 더 안정적인 수익을 얻을 수 있다. 그리고 여기에 기술적 지표까지 더하면 훨씬 더 업그레이드 할 수 있다.
* 변동성 돌파 전략이 잘 먹히려면 돌파가 일어난 후 강한 상승을 지속해야 할까? 아니면 돌파가 일어난 후 얼마 가지 않아 하락하는 경우일까? 당연히 전자다. 후자같은 경우는 긴 윗꼬리를 형성하게 된다. 윗꼬리가 뭔데?

![https://every-storytelling.tistory.com/53](../../.gitbook/assets/image%20%28364%29.png)

* 위 그림만 봐도 이해가 갈 것이다.
  * 윗꼬리는 고가와 종가\(또는 시가\)의 사이를 말한다.
  * 아랫꼬리는 저가와 종가\(또는 시가\)의 사이를 말한다.
  * 꼬리가 길수록 잡음\(=노이즈\)이 심하다. 이는 가격의 방향이 추세적이지 못하고 반전되기 쉽다는 것을 의미한다.
* 윗꼬리, 아래꼬리, 몸통에 대한 설명은 다음 링크를 참고하면 좋다.
  * [https://every-storytelling.tistory.com/53](https://every-storytelling.tistory.com/53)
* 전략 11은 전체 캔들의 길이 중 윗꼬리와 아래꼬리가 차지하는 비중을 계산해 노이즈 비율로 정의하고 여러 가상화폐 중 평균적인 노이즈 비율이 적은 종목만 선택해 매매하는 방법이다.
  * 노이즈 = 1-abs\(시가-종가\)/\(고가-저가\)
  * `abs`는 절댓값이라는 뜻이다. 시가와 종가는 상승세냐 하향세냐에 따라서 대소가 바뀌기 때문에 이러한 함수를 적용하게 된다.
* 일반적인 캔들은 통계상 윗꼬리:아래꼬리:몸통 = 1:1:2 정도로 대칭이다. 즉, 평균적인 노이즈 비율이 50%이다. 종목에 따라, 시게열 구간에 따라 계속 변한다.
  * 시계열은 일정 시간 간격에 따라 배치된 데이터를 말한다.
  * 50%보다 노이즈가 많이 높은 경우가 오래 지속되면 종목이 비추세적 구간임을 의마한다.
  * 50%보다 노이즈가 많이 낮은 경우가 오래 지속되면 추세적이거나 일중 추세가 추세적 구간임을 의미한다.
  * 노이즈 역치를 아주 낮게 잡으면 좋을 것 같지만 그러면 신호가 너무 안나온다. 따라서 노이즈 비율은 노이즈가 아주 낮은 종목을 잡는 기준보다는 노이즈가 너무 높은 매매 신호를 필터링하는 조건으로 이용하는 것이 좋다.
* 노이즈 비율을 이용하면 수많은 가상화폐 중 어떤 것을 골라야 변동성 돌파 전략으로 수익을 내기 좋은지 알 수 있다. 이를 이용해 다음과 같은 방법들을 고안할 수 있다.
  * 노이즈 값이 특정 수준 이하인 경우만 진입한다
  * 노이즈 값이 특정 수준 이하인 경우만 포트폴리오 유니버스에 편입한다.
  * 노이즈 값이 작은 종목들만 선별적으로 골라 매매한다.
* 이 때 종목 채택은 다음과 같은 방법이 있다.
  * 상대 노이즈 : 노이즈가 작은 종목 하위 n개에 투자
  * 듀얼 노이즈 : 노이즈가 작은 종목 하위 n개 + 0.55 이하 노이즈
* 방법
  * 각 종목에 투자 자금 1/n 씩 동일 비중 배분
  * 매수 : 당일 실시간 가격 &gt; 당일 시가 + \(레인지 \* k\)
    * k = 0.5 추천
  * 자금관리 : \(전일 고가-전일 저가\)/전일 종가 \* 100 값이 투자 자금의 1%를 초과하지 않도록 투자 비중 조절
  * 각 종목의 30일 평균 노이즈 값 산출
  * 투자 직전의 30일 평균 노이즈 값이 가장 작은 종목 n개 선정
  * 선정된 n개 종목의 돌파 전략 수익 곡선에 1/n 자금 투입
  * 30일 평균 노이즈 값이 가장 작으면서, 노이즈 값이 특정 역치 이하인 경우만 진입
  * 매도 : 다음 날 시가
* 결과
  * 복리수익 약 32%\(책에는 없음, 수익률이 3.5배인 것을 토대로 제시\)
  * 투자 전략 12를 소개하기 위한 노이즈 설명 파트라고 봐도 무방하다.



### 투자 전략 12. 평균 노이즈 비율 + 마켓 타이밍 + 변동성 돌파

* 변동성 돌파 전략은 추세가 강해야 수익을 낼 확률이 높아진다. 이러한 관점에서 캔들의 윗꼬리와 아래꼬리의 비율이 작다면 추세가 이어질 성향이 강하다는 것이다. 이런 정도를 노이즈 비율로 정량해 매매에 이용하는 것이 듀얼 노이즈이다.
* 듀얼 노이즈 전략은 노이즈 비율의 한계치 기준을 정해놓고, 노이즈 비율이 이보다 낮은지 그리고 다른 종목과 비교해서 상대적으로 낮은지를 평가해 매매에 적용한다. 이 방법도 의미있지만, 노이즈 비율을 좀 더 색다른 방식으로 응용하고 마켓 타이밍 전략까지 가미할 수가 있다!
  * \(1\) 평균 노이즈 비율을 돌파 계수로 이용하는 방법
    * 지금까지 살펴본 노이즈 비율은 일종의 필터링 조건이다. 또, 실제로 돌파 기준이 되는 역치\(k\)는 레인지를 기준으로 한 일종의 상수였다. \(예를 들면 필자가 추천한... k = 0.5\)
    * 그런데 여기서 문제는 돌파 계수\(k\)를 정하는 방법이 애매하다.
      * k=0.5 로 잡은 이유는 다음의 두 가지 이유가 있다.
      * 장기적인 일봉 캔들의 움직임을 통계로 보면 캔들의 위아래 꼬리와 몸통의 비율이 대략 1:1이다.
      * 백테스트 대부분이 0.5 정도의 돌파 계수가 안정적이고 높은 성과를 보여준다.
    * 하지만 이런 방식에도 단점이 있는데, 0.5라는 수치가 과거 데이터에 기반한 수치이고 이후 시장에서 동일할거라는 보장이 없다. 이는 과최적화, overfitting의 위험성이 있다.
    * 만일 실시간으로 변하는 각 종목의 최적의 돌파 계수를 알 수 있고, 이 값을 돌파 계수로 이용할 수 있다면 어떻게 될까? 강력한 시장 적응 시스템을 구성할 수 있다. 방법은 돌파 계수를 고정하는 것이 아니고 최근의 평균 노이즈 비율로 이용하는 것이다.
      * 최근의 평균 노이즈 비율은 각 종목의 최근 추세 강도를 직접적으로 대변하는 지표이기 때문에, 이것이 낮으면 추세적 성향이 강하고, 높으면 추세 반전의 성향이 강하다는 의미이다.
    * 시장 상황은 끝없이 변하기 때문에, 추세적 성향이 강한 상황에서는 굳이 0.5배수 돌파를 이용할 필요 없이 그보다 일찍 진입해도 되고, 추세 반전 성향이 강한 구간에서는 잘못된 신호를 거르기 위해 0.5보다 큰 돌파 계수를 이용해야 한다.
    * 경향성을 민감하게 하기 위해 최근 30일 평균 노이즈 비율보다 20일 평균 노이즈 비율을 사용해도 된다. 지엽적인 문제이기에 세부적인 수치에 집착할 필요는 없다. 23일이어도 27일이어도 된다.
  * \(2\) 평균 이동평균선 스코어를 이용한 마켓 타이밍 결합 방법
    * 마켓 타이밍 전략을 이용할 때 고정된 값을 이용하는 것은 바람직하지 않다. 과거 데이터를 이용한 백테스트에서는 어떤 이동평균선 값이 최적인지 찾아내기 쉽지만, 이 값이 미래에도 최적이라는 보장이 없다. 따라서 여러 이동평균선 값에 분산하는 것이 필요하다. 가장 간단한 방법은 평균 이동평균선 스코어를 이용하는 방법이며 스코어는 다음과 같이 산출한다.
      * 마켓 타이밍을 적용하고 싶은 이동평균선을 여러 개를 정한다. \(ex 3, 5, 10 ,20\)
      * 종가가 해당 이동평균선보다 높으면 1점, 낮으면 0점을 부여한다.
      * 각 점수의 평균을 산출한다.
      * 예를 들어 오늘 종가가 3일과 10일 이동평균선 보다 높으면 점수의 평균은 \(1+0+1+0\)/4 = 0.5이다.
  * \(3\) 평균 노이즈 비율과 평균 이동평균선 스코어를 이용한 변동성 돌파 전략 포트폴리오
    * 이 방법을 이제 소개한다.
* 방법
  * 종목당 기본 투자 비중 : 1/n\(동일 비중\) \* 전일 기준 이동평균선\(3, 5, 10 ,20\) 스코어
  * 매수 : 실시간 가격 &gt; 당일 시가 + \(전일 레인지 \* 20일 평균 노이즈 비율\)
  * 자금 관리 : \(전일 고가 - 전일 저가\)/전일 종가 \* 100 값이 투자 자금의 k%를 초과하지 않도록 투자 비중 조절
  * 매도 : 다음 날 시가
  * 예시
    * 총 자산 1000만원
    * 5개 코인에 분산 투자 예정. 따라서 한 코인 당 200만원 할당
    * A코인은 이동평균선 스코어가 0,5이다. 따라서 추세 강도를 고려해 100만원 할당.
    * A코인의 전일 변동 폭이 4%이고, 자금 관리 룰 2%\(목표 변동률\)을 적용한다면 2/4 = 50%이므로 50만원을 최종 투입.
* 변동성 3%
  * 복리수익 143.6%
  * MDD -3.8%
* 변동성 2% 
  * 복리수익 99.2%
  * MDD -2.7%
* 변동성 1%
  * 복리수익 46.4%
  * MDD -1.9%
* 분석
  * 평균 이동평균선 스코어를 이용한 추세 추종 + 돌파 계수를 찾아주는 평균 노이즈 비율을 적용한 결과 안정적이고 뛰어난 성과
  * 특히, 자금 관리 룰을 공격적으로 적용\(3% 룰\)해도 MDD에는 큰 차이가 없다. 이는 룰이 공격적으로 적용하면 MDD가 급증하는 것과 비교하면 굉장히 우수한 결과.



### 투자 전략 13. 오전 투자 + 변동성 돌파

* 합성 전략을 제시하는 것이 투자 전략의 마지막.
* `전략 5. 오전 천국, 오후 지옥 + 전략 12. 평균 노이즈 비율 + 평균 이동평균선 돌파` 에 절반씩 투자하는 합성 전략
* 방법
  * 전략 A
    * 매수 : 실시간 가격 &gt; 당일 시가\(0시\) + \(전일 오전 레인지 \* 20일 평균 노이즈 비율\)
    * 평균 이동평균선 스코어 : 3, 5, 10, 20일 이동평균성을 사용하되, 1일이 아니라 12시간 기준\(오전\)
    * 투자 비중 : \(타깃 변동성 / 전일 오전 변동성\) \* 평균 이동평균선 스코어
    * 매도 : 정오
  * 전략 B
    * 매수 : 전일 오후 수익률 &gt; 0, 전일 오후 거래량 &gt; 전일 오전 거래량
    * 매수 : 오전 0시
    * 투자 비중 : 타깃 변동성 / 전일 오전 변동성
    * 매도 : 정오
* 변동성 2%

|  | 전략 A | 전략 B | 전략 A 50% + 전략 B 50% |
| :---: | :---: | :---: | :---: |
| 총수익 | 12.83배 | 19.96배 | 16.54배 |
| 복리수익 | 82.3% | 102.3% | 93.53% |
| MDD | 5.74% | 11.22% | 7.13% |
| 승률 | 55.30% | 57.98% | 60.14% |
| 손익비 | 1.40 | 2.33 | 2.60 |
| 1일 2% 이상 손실 | 23회 | 44회 | 11회 |
| 1일 1% 이상 손실 | 3회 | 8회 | 2회 |

* 변동성 1%

|  | 전략 A | 전략 B | 전략 A 50% + 전략 B 50% |
| :---: | :---: | :---: | :---: |
| 총수익 | 6.34배 | 7.39배 | 6.96배 |
| 복리수익 | 54.41% | 60.15% | 57.88% |
| MDD | 3.00% | 8.71% | 4.97% |
| 승률 | 55.30% | 57.98% | 60.94% |
| 손익비 | 1.40 | 2.40 | 2.72 |
| 1일 2% 이상 손실 | 8회 | 16회 | 2회 |

* 분석
  * 우수 전략 2개를 합쳤을 때 수익은 늘어나지 않았지만 나머지 지표들이 모두 개선되었다.
  * MDD는 두 전략의 평균이 아니라 전략 A에 훨씬 가깝고, 승률과 손익비는 전략 A와 B보다 높다.
  * 또한 하루에 1%, 2% 이상 깨지는 날도 현저히 줄었다.
  * 이런 결과가 나온 이유?
    * 두 전략을 각각 써도 훌륭한 전략이다.
    * 두 전략의 상관성은 1보다 훨씬 낮다. 정확히 말하면 0.02정도이다.
      * 상관성이 낮은 자산뿐만 아니라 전략으로도 분산투자가 가능하다.
      * 동일한 코인을 매수하더라도 매수 기준이 달라서 일일 수익이 다르다.



### 전략 총 정리

* **전략 1. 가상화폐 10% + 현금 90%**
  * 복리수익 29.7% MDD 10.5%
* **전략 2. 이동평균 + 현금 비중 80%이상**
  * 현금 비중 80% 복리수익 36.1% MDD 8.5%
  * 현금 비중 90% 복리수익 16.9% MDD 4.3%
* **전략 3. 슈퍼 상승장 + 변동성 조절**
  * 변동성 2% 복리수익 50.8% MDD 6.73%
* **전략 4. 듀얼 모멘텀 + 현금 비중 최소 90%**
  * 복리수익 49.92% MDD 10.4%
* **전략 5. 오전 천국, 오후 지옥**
  * 단순 오전 매수 복리수익 61.13% MDD 70.02%
  * 전일 오후 수익률 상승시 오전 매수 복리수익 220.34% MDD 25.27%
  * 전일 오후 수익률 및 거래량 상승 시 오전 매수 복리수익 218.82% MDD 17.98%
  * 변동성 2% + 전일 오후 수익률 및 거래량 상승 시 오전 매수 복리수익 80.6% MDD 10.5%
  * 변동성 1% + 전일 오후 수익률 및 거래량 상승 시 오전 매수 복리수익 39.47% MDD 5.78%
* **전략 6. 다자 가상화폐 + 변동성 돌파**
  * 복리수익 521% MDD 21.3%
* **전략 7. 다자 가상화폐 + 상승장 + 변동성 돌파**
  * 복리수익 308% MDD 11.3%
* **전략 8. 상승장 + 변동성 돌파 + 변동성 조절**
  * 변동성 5% 복리수익 181.6% MDD 5.33%
  * 변동성 2% 복리수익 84.9% MDD 4.15%
  * 변동성 1% 복리수익 41.9% MDD 2.7%
* **전략 9. 4개 이동평균 상승장 + 변동성 돌파 + 변동성 조절**
  * 변동성 2% 복리수익 63.5% MDD 2.51%
* **전략 10. 5일 이동평균 + 5일 거래량 상승장 + 변동성 돌파 + 변동성 조절**
  * 변동성 2% 복리수익 37.56% MDD 1.90%
* **전략 11. 다자 가상화폐 + 평균 노이즈 비율**
  * 복리수익 약 32% MDD 알 수 없음
* **전략 12. 평균 노이즈 비율 + 마켓 타이밍 + 변동성 돌파**
  * 변동성 3% 복리수익 143.6% MDD 3.8%
  * 변동성 2% 복리수익 99.2% MDD 2.7%
  * 변동성 1% 복리수익 46.4% MDD 1.9%
* **전략 13. 오전 투자 + 변동성 돌파**
  * 변동성 2% 복리수익 93.53% MDD 7.13%
  * 변동성 1% 복리수익 57.88% MDD 4.97%



### 투자 성향에 따른 전략

* 이 전략은 14~18년도 과거 데이터를 가지고 백테스팅해서 얻은 통계적 결과를 가지고 세운 전략이며, 실제로 전략을 결정 및 실행하기 전에 반드시 백테스팅으로 검증하는 과정을 거쳐야 한다.
* 변동성 조절 전략이 있을 경우 목표 변동성은 2%이다.
* 복리 수익 우선
  * 1️⃣ 전략 6. / 복리수익 521% MDD 21.3%
  * 2️⃣ 전략 7. / 복리수익 308% MDD 11.3%
  * 3️⃣ 전략 5. 中 전일 오후 수익률 및 거래량 상승 시 오전 매수 / 복리수익 218.82% MDD 25.27%
* MDD복리 수익 우선
  * 1️⃣ 전략 10. / 복리수익 37.56% MDD 1.90%
  * 2️⃣ 전략 12. / 복리수익 99.2% MDD 2.7%
  * 3️⃣ 전략 8. / 복리수익84.9%  MDD 4.15%
* MDD대비 복리 수익 우선 \(MaxMin-Scaling 사용\)
  * 1️⃣ 전략 6. / 복리수익 521% MDD 21.3% / 72점
  * 2️⃣ 전략 7. / 복리수익 308% MDD 11.3% / 43점
  * 3️⃣ 전략 5. 中 전일 오후 수익률 및 거래량 상승 시 오전 매수 / 복리수익 218.82% MDD 25.27%
  * MDD 대비 복리수익이 너무나도 커서 복리 수익 우선 결과와 동일하게 나온것으로 보인다.
* MDD대비 복리 수익 우선 구하는 방법 코드 \(크게 신경쓰지 않아도 된다\)

```python
def cal(a, b):
	return round((a-29.7) / 491.3 - (b-1.90) / 68.12, 2)
	# 복리수익 최대 521% 최소 29.7% 차이 491.3%
	# MDD 최대 70.02% 최소 1.90% 차이 68.12%
	
for idx, a, b in zip(["5-2", "5-3", "5-4", "6", "7", "8", "9", "10", "12", "13"], 
	[220.34, 218.82, 80.6, 521, 308, 84.9, 63.5, 37.56, 99.2, 93.53], 
	[25.27, 17.98, 10.5, 21.3, 11.3, 4.15, 2.51, 1.90, 2.7, 7.13]):
	print(idx, " : ", cal(a, b))

'''
5-2  :  0.04
5-3  :  0.15
5-4  :  -0.02
6  :  0.72
7  :  0.43
8  :  0.08
9  :  0.06
10  :  0.02
12  :  0.13
13  :  0.05
'''
```



### 테크닉 총 정리

1. 오전 투자
   * 모든 수익은 오전에 난다. 오후에 투자하면 돈을 모두 날린다.
2. 상승장 투자
   * 이동평균선등으로 판단한 상승장에만 투자할 것
3. 변동성 조절
   * 변동성을 조절해서 MDD 감소
4. 다자 가상화폐 분산투자
   * 변동성 조절보다는 약하지만 MDD 감소에 어느 정도 기여
5. 슈퍼 상승장
   * 가격이 이동평균선을 여러 개 넘었을 때 투자하면 승률이 조금 높아진다.
6. 거래량
   * 가격이 오를 때 거래량도 같이 오르면 상승장이 지속될 가능성이 높아진다.
7. 변동성 돌파
   * 상승장에서 또 한 번 가속을 내는 가상화폐를 매매하자.
8. 노이즈
   * 캔들에서 몸통이 큰 가상화폐는 추세가 강하다. 노이즈는 종목 선정에도, 돌파 계수로도 사용할 수 있다!
9. 평균 이동편균선 스코어
   * 가격이 몇 개 이동평균선보다 높은지 측정해 상승장의 강도를 재는 지표다. 투자 규모를 조절할 때 참고한다.
10. 전략 혼합
    * 자체적으로 훌륭하면서도 상관성이 떨어지는 전략들에 동시 투자하면 1+1 = 3이 디는 시너지가 생긴다.



### 그 이외의 조언

* 변동성 돌파 전략은 치명적인 약점이 있다. 바로 가격이 언제 시가 + \(전일 레인지 \* 0.5\)를 돌파할지 모른다는 점이다. 그렇다고 24시간 지켜보면서 가격을 예의주시할 수는 없다. 따라서 변동성 돌파 전략을 구현하려면 자동화 매매 프로그램 개발이 필수다. 방법은 여러가지다
  * 파이썬을 직접 공부해서 자동화 매매 프로그램 만들기
  * 일정 금액을 주고 자동화 매매 프로그램 외주
  * 자동화 매매 서비스 사용





