---
description: '210801, 210802'
---

# Relations - 다대일 관계

## 다대일 관계 - author \(작성자\) 추가하기

#### 다대일 관계

A모델의 여러 레코드가 B모델의 한 레코드에 연결될 수 있는 관계

* 한 유저가 여러개의 포스트를 작성했을 때 포스트라는 여러 레코드가 유저라는 한 레코드에 연결된다

위 관계를 가지는 작성자 필드를 추가할 것임

`models.py`

```python
from django.contrib.auth.models import User

class Post(models.Model):
    author = models.ForeignKey(User, on_delete=models.CASCADE)
    
def __str__(self):
    return f"{self.pk} {self.title} :: {self.author}"    
```

* 외래키 필드를 추가한다. 이 때 `on_delete` 속성은 만약 author가 삭제되었을 경우, 해당 포스트를 삭제할 것이냐고 묻는 것이다.
  * cascade는 삭제하라는 뜻이며 6가지의 속성을 설정할 수 있다.
  * [여기](https://vallhalla-edition.tistory.com/60) 참고
* 이 때 migrations을 진행하면 다음과 같은 텍스트가 뜨는데, default값을 정해달라는 뜻이다.
  * 1번은 migration 할테니, default를 지금 정해달라.
  * 2번은 migration를 취소하고 default를 정하라

```text
You are trying to add a non-nullable field 'author' to post without a default; we can't do that (the database needs
 something to populate existing rows).
Please select a fix:
 1) Provide a one-off default now (will be set on all existing rows with a null value for this column)
 2) Quit, and let me add a default in models.py
Select an option:
```

여기서는 1을 누른다.

```text
Please enter the default value now, as valid Python
The datetime and django.utils.timezone modules are available, so you can do e.g. timezone.now
Type 'exit' to exit this prompt
>>> 1
```

그리고 1을 입력한다. 그러면 1번째 사용자의 이름이 기본 이름으로 설정된다.



## 연결된 레코드가 삭제될 때 동작 결정하기 - CASCADE, SETNULL

```text
author = models.ForeignKey(User, null=True, on_delete=models.SET_NULL)
```

다음과 같이 `on_delete` 속성을 `SET_NULL`로 설정할 수도 있다. 이 때 반드시 `null=True`를 같이 설정해줘야 한다.

이 때 포스트를 작성한 적 있는 유저를 삭제하면 해당 포스트의 이름은 None으로 남게 된다.





## 포스트 목록, 포스트 상세 페이지에 작성자 추가하기





## Category 만들기

















